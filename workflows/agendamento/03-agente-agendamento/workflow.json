[
  {
    "createdAt": "2025-05-13T11:40:55.429Z",
    "updatedAt": "2025-06-05T22:17:51.000Z",
    "id": "WtnGrmEzoPOlhAWT",
    "name": "[FA] Agente de Agendamento",
    "active": false,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1.1,
        "position": [
          0,
          0
        ],
        "id": "733f5a28-968e-4d38-a6b3-ce8ce05c354e",
        "name": "Receber msg do usuario",
        "webhookId": "e81f2ba2-95ea-40a8-98c8-72b7530a403e"
      },
      {
        "parameters": {
          "options": {
            "systemMessage": "=Você é um Agente que tem como principal função Agendar Eventos para os usuários, e fazer outras tarefas relacionadas a estes eventos\n\n1 - Para saber os eventos disponíveis:\n\nUse a ferramenta Resgata todos os Eventos Disponiveis, que é onde você obterá uma lista de todos os eventos que o usuário pode escolher\n\nNão exiba eventos ocultos\n\n2 - Para ver se há horários disponiveis em algum evento em determinada data:\n\nUse a ferramenta Resgatar Horarios dos Eventos\n\npassando as datas de início como start e fim como end\n\nas datas devem estar no padrão UTC timezone como ISO 8601 datestring\n\nA hora é opcional, só se o usuário especificar\n\nExemplo de datas: 2050-09-05T09:00:00.000+02:00\n\nDetalhe importante: Você recebe os horários em UTC dos eventos, e precisa converter para America/Sao_Paulo antes de passar para o usuário\n\n3 - Para marcar o evento:\n\nAntes de marcar o evento peça Nome e Email do usuário\n\nAgora utilize a tool ScheduleEvent para marcar o evento\n\nEnvie os dados que o usuário passou, o id do evento que ele selecionou e também a data e hora que o usuário marcou o evento\n\nLembrando: o eventTypeId, ou seja, id do evento, deve ser consultado na tool de eventos disponíveis, pois é de lá que essa informação vem\n\nRetorne o uid do evento para o usuário, chame este dado de Chave da Reunião\n\nExplique para ele que para realizar qualquer alteração (reagendamento, cancelamento), ele precisará informar este dado antes de realizar as ações que deseja, diga também para ele guardar com cuidado a Chave\n\n4 - Para cancelar um evento:\n\nPeça a chava secreta do evento e também uma razão para o cancelamento, depois use a tool CancelEventTool e mande para ela a chave e a razão\n\nA chave deve ser enviada como bookinUid e a razão como reason\n\nAo cancelar com sucesso informe para o usuário que tudo deu certo\n\n\n5 - Para reagendar um evento:\n\nPergunte primeiramente para que dia ele quer reagendar\n\nEnvie para o usuario novas opcoes de horário no fuso America/Sao_Paulo, você pode fazer isso pegando as informações do evento marcado em GetEventTool\n\nDepois acessando a tool de Horários Disponíveis você receberá todos os horários que o usuário pode remarcar o evento\n\nE então peça o horário para o usuário, você precisa transformar este horário em UTC timezone como ISO 8601 datestring\n\nO usuário sempre passará em America/Sao_Paulo e você deve converter antes de passar para a tool RescheduleTool\n\nPeça também uma razão para o reagendamento\n\nEnvie a data convertida para UTC, a razão do reagendamento e o bookingUid para a tool RescheduleTool\n\nApós a confirmação de reagendamento, envie uma mensagem de sucesso para o usuário, e informe a nova chave do evento (o uid), pois ao reagendar a chave alterada, alerte o usuário sobre isso tambem\n\nIMPORTANTE: o reagendamento sempre muda a data do evento, você não pode passar a mesma data do evento original, verifique antes de mandar\n\n6 - Para saber todos os detalhes de um evento:\n\nPeça ao usuário a chave do evento\n\nFormate a resposta de forma muito detalhada, exibindo todos os detalhes que são importantes do evento para o usuário\n\n---\n\nInformação Importante:\n\nData de Hoje: {{ $now }}"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.8,
        "position": [
          220,
          0
        ],
        "id": "8d1f4ad8-b40a-49c8-afa8-bd9ed77021bf",
        "name": "Agente de Agendamento"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4.1-mini",
            "mode": "list",
            "cachedResultName": "gpt-4.1-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          120,
          280
        ],
        "id": "ee6aeccc-6bdb-4a46-a88d-b662d46b6230",
        "name": "GPT 4.1 mini",
        "credentials": {
          "openAiApi": {
            "id": "H79y1c1UARm5hINL",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "contextWindowLength": 7
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          320,
          280
        ],
        "id": "2db07052-ce29-4221-9db3-9da84af81a24",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "toolDescription": "Utilize esta ferramenta para saber todos os eventos que temos disponiveis para o usuario",
          "url": "https://api.cal.com/v2/event-types",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "typeVersion": 1.1,
        "position": [
          600,
          320
        ],
        "id": "0458deb4-3504-401c-9cee-b1dd95f36d54",
        "name": "Resgata todos os Eventos Disponiveis",
        "credentials": {
          "httpHeaderAuth": {
            "id": "WEyM3Tk5faRx2BkK",
            "name": "Cal.com"
          }
        }
      },
      {
        "parameters": {
          "name": "ScheduleEvent",
          "description": "=recebe os dados do agendamento do evento\n\n- nome\n- email\n- id do evento\n- hora que o usuário quer marcar o evento",
          "workflowId": {
            "__rl": true,
            "value": "sHWwWYRbDqgVJY9T",
            "mode": "list",
            "cachedResultName": "[FA] Agente de Agendamento - Agendar"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('name', ``, 'string') }}",
              "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('email', ``, 'string') }}",
              "eventTypeId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('eventTypeId', ``, 'number') }}",
              "dateTime": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('dateTime', ``, 'string') }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "name",
                "displayName": "name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "email",
                "displayName": "email",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "eventTypeId",
                "displayName": "eventTypeId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "number"
              },
              {
                "id": "dateTime",
                "displayName": "dateTime",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.1,
        "position": [
          1020,
          320
        ],
        "id": "2d312302-db9c-412c-8188-a871ac0acf6d",
        "name": "Agendar Evento"
      },
      {
        "parameters": {
          "content": "## Fluxo de Agendar Evento\n",
          "height": 280,
          "width": 680
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          500,
          220
        ],
        "typeVersion": 1,
        "id": "a0aef8e2-fa2f-4ac5-b76b-16f3835bf6a7",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "name": "CancelEventTool",
          "description": "Chame esta ferramenta quando um usuário precisa cancelar um evento",
          "workflowId": {
            "__rl": true,
            "value": "74RFbyQrpsvH3PTq",
            "mode": "list",
            "cachedResultName": "[FA] Agente de Agendamento - Cancelar Evento"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "bookingUid": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('bookingUid', ``, 'string') }}",
              "reason": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('reason', ``, 'string') }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "bookingUid",
                "displayName": "bookingUid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "reason",
                "displayName": "reason",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.1,
        "position": [
          880,
          -40
        ],
        "id": "b617cdd6-89b2-4a2b-a0fb-e366481cd68c",
        "name": "Cancelar Evento"
      },
      {
        "parameters": {
          "name": "RescheduleTool",
          "description": "Use esta ferramenta para reagendar um evento quando o usuário solicitar\n\na data",
          "workflowId": {
            "__rl": true,
            "value": "AaokCs28xagfQ6sc",
            "mode": "list",
            "cachedResultName": "[FA] Agente de Agendamento - Reagendamento"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('start', ``, 'string') }}",
              "reason": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('reason', ``, 'string') }}",
              "bookingUid": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('bookingUid', ``, 'string') }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "start",
                "displayName": "start",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "reason",
                "displayName": "reason",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "bookingUid",
                "displayName": "bookingUid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.1,
        "position": [
          1040,
          -40
        ],
        "id": "c8ec409f-30c0-40c1-96d6-65af06d7a336",
        "name": "Reagendar Evento"
      },
      {
        "parameters": {
          "name": "GetEventTool",
          "description": "Esta tool pega detalhes de um evento",
          "workflowId": {
            "__rl": true,
            "value": "49xmAJG7txURIxrp",
            "mode": "list",
            "cachedResultName": "[FA] Agente de Agendamento - Detalhes do Evento"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "bookingUid": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('bookingUid', ``, 'string') }}"
            },
            "matchingColumns": [
              "bookingUid"
            ],
            "schema": [
              {
                "id": "bookingUid",
                "displayName": "bookingUid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.1,
        "position": [
          1220,
          -40
        ],
        "id": "f7da6319-20ea-46b8-8b05-28d2b9162475",
        "name": "Detalhes do Evento"
      },
      {
        "parameters": {
          "content": "## Ações para Evento",
          "height": 320,
          "width": 600,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          800,
          -180
        ],
        "typeVersion": 1,
        "id": "e05b216f-13f3-43ca-9dae-4377b3964dfa",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "toolDescription": "Utilize esta ferramenta para consultar os horários disponíves de um determinado evento",
          "url": "https://api.cal.com/v2/slots",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendQuery": true,
          "parametersQuery": {
            "values": [
              {
                "name": "start",
                "valueProvider": "fieldValue",
                "value": "{start}"
              },
              {
                "name": "end",
                "valueProvider": "fieldValue",
                "value": "{end}"
              },
              {
                "name": "eventTypeId",
                "valueProvider": "fieldValue",
                "value": "{eventTypeId}"
              }
            ]
          },
          "sendHeaders": true,
          "parametersHeaders": {
            "values": [
              {
                "name": " cal-api-version",
                "valueProvider": "fieldValue",
                "value": "2024-09-04"
              }
            ]
          },
          "placeholderDefinitions": {
            "values": [
              {
                "name": "start",
                "description": "Hora de início da janela de tempo no formato UTC como ISO 8601",
                "type": "string"
              },
              {
                "name": "end",
                "description": "Hora de fim da janela de tempo no formato UTC como ISO 8601",
                "type": "string"
              },
              {
                "name": "eventTypeId",
                "description": "Evento a ser consultado. Sempre busque pelo id do evento utilizando a ferramenta de listar eventos.",
                "type": "string"
              }
            ]
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "typeVersion": 1.1,
        "position": [
          420,
          600
        ],
        "id": "6113a653-6335-40a6-8e30-1c43df093aa9",
        "name": "ANTIGO - Resgatar Horarios dos Eventos",
        "credentials": {
          "httpHeaderAuth": {
            "id": "WEyM3Tk5faRx2BkK",
            "name": "Cal.com"
          }
        }
      },
      {
        "parameters": {
          "toolDescription": "Utilize esta ferramenta para consultar os horários disponíves de um determinado evento",
          "url": "https://api.cal.com/v2/slots",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "start",
                "value": "={{ $fromAI('parameters0_Value', `Data em formato ISO`, 'string') }}"
              },
              {
                "name": "end",
                "value": "={{ $fromAI('parameters1_Value', `Data em formato ISO`, 'string') }}"
              },
              {
                "name": "eventTypeId",
                "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', ``, 'string') }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "cal-api-version",
                "value": "2024-09-04"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.2,
        "position": [
          800,
          320
        ],
        "id": "6f056561-8251-46a0-8b31-c653f26a9e50",
        "name": "Resgatar Horarios dos Eventos",
        "credentials": {
          "httpHeaderAuth": {
            "id": "WEyM3Tk5faRx2BkK",
            "name": "Cal.com"
          }
        }
      }
    ],
    "connections": {
      "Receber msg do usuario": {
        "main": [
          [
            {
              "node": "Agente de Agendamento",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GPT 4.1 mini": {
        "ai_languageModel": [
          [
            {
              "node": "Agente de Agendamento",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "Agente de Agendamento",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Resgata todos os Eventos Disponiveis": {
        "ai_tool": [
          [
            {
              "node": "Agente de Agendamento",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Agendar Evento": {
        "ai_tool": [
          [
            {
              "node": "Agente de Agendamento",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Cancelar Evento": {
        "ai_tool": [
          [
            {
              "node": "Agente de Agendamento",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Reagendar Evento": {
        "ai_tool": [
          [
            {
              "node": "Agente de Agendamento",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Detalhes do Evento": {
        "ai_tool": [
          [
            {
              "node": "Agente de Agendamento",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "ANTIGO - Resgatar Horarios dos Eventos": {
        "ai_tool": [
          []
        ]
      },
      "Resgatar Horarios dos Eventos": {
        "ai_tool": [
          [
            {
              "node": "Agente de Agendamento",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true
    },
    "pinData": {},
    "versionId": "a3a1d293-cfa3-4b25-a984-3396ef4af421",
    "triggerCount": 0,
    "tags": [
      {
        "createdAt": "2025-05-26T19:48:27.869Z",
        "updatedAt": "2025-05-26T19:48:27.869Z",
        "id": "hbBJw9VpX8CbCKpn",
        "name": "FA"
      }
    ]
  }
]